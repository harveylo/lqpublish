title:: .NET Core Components of Hosting

- [原文](https://github.com/dotnet/runtime/blob/main/docs/design/features/host-components.md)
- .NET Core默认的hosting起动项包括一些components
- # Entry-point hosts
	- .NET Core有一些作为entry-point来启动代码执行的可执行文件和库
	- 这些可执行文件或库便被称为**host**
	- ``dotnet``(可执行文件)
		- 位于**共享位置(shared location)**[[$red]]==**(?)**==
		- 是机器上的最新版本
		- 有时被称为**"muxer"**
	- ``apphost``(可执行文件)
		- 为了给应用一个可以直接运行的可执行文件
		- 这个可执行文件通常使用应用的名字明明
		- 可以被自定义名字和图标甚至是操作系统行为
	- ``comhost``(库)
		- 用于启用COM服务器hosting
		- 想暴露COM服务器对象的component会在最终输出时用此动态库建造
			- ``comhost``会充当针对OS的main entry point
	- ``ijwhost``(库)
		- 用于启用加载IJW程序集
		- 用于生成mixed mode assemblies
	- ``nethost``（库）
		- native app(任何非.NET Core的app)使用此库动态加载.NET Core代码
	- 这些entry-point一般只做一件事：找到``hostfxr``库，并把控制权限交予此库
		- 此库还会进一步暴露正确的entry point用于程序执行
	- 对于``dotnet`` host来说，``hostfxr``通过相对目录``./host/fxr/<version>``获取
	- 对于其他host来说，``hostfxr``通过以下过程定位
		- 应用的文件夹首先被搜索
		- 如果``DOTNET_ROOT``环境变量被定义，搜索此路径
		- 搜索默认的共享位置
- # Host FXR
	- 此库寻找并解析运行时和其他所有应用程序需要的框架
	- 然后加载``hostpolicy``库，并移交控制权
	- 此库读取应用程序的``.runtimeconfig.json``然后解析框架
		- 其实现了框架解析的算法，参见[SharedFx Lookup](https://github.com/dotnet/runtime/blob/main/docs/design/features/sharedfx-lookup.md)和[Framework version resolution](https://github.com/dotnet/runtime/blob/main/docs/design/features/framework-version-resolution.md)
	- 大多数情况下，最新版本的``hostfxr``会被使用，Self-contained应用使用自己目录下的`hostfxr`
- # Host Policy
	- 此库实现实际载入运行时，应用配置，解析应用依赖并调用运行时执行应用或加载所需component的策略
	- 此库位于运行时文件夹下，例如``C:\Program Files\dotnet\shared\Microsoft.NETCore.App\<version>``
	- 此库读取应用程序的``.deps.json``文件(以及所有引用的框架的``.deps.json``文件)，解析所有此文件知名的程序集并创建一个程序集路径列表(也被称为**TPA**)
	- 对于native dependency也做类似的事情
	- 最后此库加载并初始化运行时``coreclr``库