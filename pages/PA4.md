- # 多道程序
	- 将nano-lite改造成一个多道程序需要完成以下两点：
		- **内存中可以同时存在多个进程**
		- **在满足某些条件的情况下**，可以让**执行流在进程间切换**
	- ## 上下文切换
		- 上下文的本质是进程的状态
		- ### 基本原理
			- 系统调用时``__am_asm_trap()``函数会保存某个进程的上下文在其自身的栈上，并在系统调用处理结束之后通过栈上的``Context``结构体还原进程状态
			- 如果在系统调用结束之后不立即返回自身的状态而是将栈帧改为另外一个进程的栈，就可以从另外一个进程的栈中取出上下文并恢复，并继续运行另一个进程
		- ### 进程控制块
			- 某个进程的上下文在栈上的保存地址并不是固定的，为了能够在切换时准确获取到上下文，需要有一个``cp``指针，用于指向栈上的上下文保存地址
				- 需要寻找其他进程的上下文结构时，找到``cp``即可
			- 类似，``cp``，栈空间等信息也是**进程相关的**，操作系统使用一种统一的**进程控制块(PCB)**数据结构对进程相关信息进行管理
			- nano-lite代码框架中已经定义了此数据结构于:``nano-lite/include/proc.h``
			- ```
			  typedef union {
			    uint8_t stack[STACK_SIZE] PG_ALIGN;
			    struct {
			      Context *cp;
			    };
			  } PCB;
			  ```
				- 使用一个union把其他信息放置于堆栈底部(Nanolite为每一个进程分配32KB堆栈)
				- 继续宁上下文切换时只需要将PCB中的``cp``返回给CTE的``__am_irq_handle()``函数即可
		- ### 内核线程
			- 不由任何进程管理，而有操作系统直接创建和调度的线程
			- 对于一个刚加载的进程，为其创建一个新的上下文并根据这个结构来恢复即可使其运行起来，这种创建上下文并运行叫做**内核线程**
			- 创建内核线程上下文通过CTE提供的``kcontext()``函数提供，位于``abstract-machine/am/src$ISA/nemu/cte.c``
		- ### 线程/进程调度
			- 上下文
-